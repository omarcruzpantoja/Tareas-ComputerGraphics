<html>

<head>
<title>HTML5 Canvas &mdash; Demo scenegraph</title>
<meta http-equiv="content-type" content="text/html; charset=UTF8">
<script type="text/javascript" src="dat.gui.js"></script>

<style>
    canvas {border: solid 1px black}
    td {vertical-align: top;}
</style>
</head>

<script type="text/javascript">
    window.requestAnimFrame = (function() {
      return window.requestAnimationFrame ||
             window.webkitRequestAnimationFrame ||
             window.mozRequestAnimationFrame ||
             window.oRequestAnimationFrame ||
             window.msRequestAnimationFrame ||
             function(/* function FrameRequestCallback */ callback, /* DOMElement Element */ element) {
               window.setTimeout(callback, 1000/60);
             };
    })();

    var canvas;
    var ctx;
    var w,h;
   
    var params
    function initParams() {
        params = {
            'x0': 150,
            'y0': 250,
            'a1': 0,
            'a2': 0,
            'a3': 0,
        }
    }
   
    /* ### GUI ### */
    var gui;		
    function initGUI() 
    {
        gui = new dat.GUI({ autoPlace: true });

        gui.add(params,'x0').min(0).max(w).step(1)
                            .onChange(onParamsChange)//.listen()
        gui.add(params,'y0').min(0).max(h).step(1)
                            .onChange(onParamsChange)//.listen()
        gui.add(params,'a1').min(-80).max(120).step(1)
                               .onChange(onParamsChange)//.listen()
        gui.add(params,'a2').min(-80).max(150).step(1).onChange(onParamsChange)
        gui.add(params,'a3').min(0).max(+150).step(0.1)
                            .onChange(onParamsChange)//.listen()
        
        //var parent = document.getElementById('controls');      
        //parent.appendChild(gui.domElement);
    }
    // GUI callback when parameters are changed manually in the GUI
    function onParamsChange() {
        drawAll()
    }

    /* ### Keyboard ### */
    var currentlyPressedKeys = {};
    function initKeys(canvas) {
        // Make sure the canvas can receive the key events
        canvas.setAttribute('tabindex','0');
        canvas.focus();

        // Register the keyDown and keyUp events
        canvas.addEventListener( "keydown", onKeyDown, true);
        canvas.addEventListener( "keyup", onKeyUp, true);
    }
    // Callbacks for discrete key events
    function onKeyDown(event) {
        // Uncomment this to display key presses to find the keyCodes
        console.log(event)
        event.preventDefault();
        
        // Handle single key presses (for example for firing the gun)
        if (event.keyCode == 67) { // K
            console.log('Pressed "K"')
        }
    }
    function onKeyUp(event) {
    }
    

    /* ### Drawing ### */
    function drawArm(ctx) {
        // TODO
        ctx.strokeStyle="red";
        ctx.strokeText('Draw arm here', 0,0)
    }
    function drawUpperLeg(ctx) {
        // TODO
        ctx.strokeStyle="green";
        ctx.strokeText('Draw upperLeg here', 0,0)
    }
    function drawLowerLeg(ctx) {
        // TODO
        ctx.strokeStyle="blue";
        ctx.strokeText('Draw lowerLeg here', 0,0)
    }
    function drawBody(ctx) {
        // TODO
        ctx.strokeStyle="black";
        ctx.strokeText('Draw body here', 0,0)
    }

    function drawAll() {
        // Reset transform before clearing the canvas
        ctx.setTransform(1,0,0, 1,0,0)
        ctx.clearRect(0,0,canvas.width,canvas.height)

        ctx.save()
        ctx.translate(50, 50)
        drawArm(ctx)
        ctx.restore()
        
        ctx.save()
        ctx.translate(50, 100)
        drawUpperLeg(ctx)
        ctx.restore()
        
        ctx.save()
        ctx.translate(50, 150)
        drawLowerLeg(ctx)
        ctx.restore()
        
        ctx.save()
        ctx.translate(params.x0, params.y0)
        drawBody(ctx)
        ctx.restore()
    }

    /* ### Initialization ### */ 
    function start() {
        canvas = document.getElementById('canvas');
        ctx = canvas.getContext('2d');
        
        w = canvas.width;
        h = canvas.height;

        // Do init
        initParams()
        initGUI()
        initKeys(canvas)
        
        // Draw for the first time
        drawAll()

        // Launch main animation loop
        //onTick()
    }
</script>

<body onload="start();">
    <h2>Scenegraph</h2>
    <table><tbody><tr>
    
    <td>
    <table><tbody>
    <tr>
    <td><canvas id="canvas" width="300" height="300"></canvas></td>
    </tr>
    <tr>
    <td>Canvas</td>
    </tr>
    <tr>
    <td><small><span id="text"></span></small></td>
    </tr>
    </tbody></table>
    </td>
    
</body>
</html>   
